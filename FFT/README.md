# FFT on FPGA
Implementation of the Fast FOurier Transform on a Basys 3 FPGA.

This implementation is an extension and wrapper for an existing fft implementation made by Wojciech Zabolotny found on https://opencores.org/.


## Setup
This entire setup was tested and compiled using Vivado 2016.2 and the simulations run on modelsim (because the vivado simulator keeps crashing on me). This setup only needs to be done once.

1. Go through the same steps of creating a project from scratch.
2. Import the files from the `sources` folder as design sources. Be sure to copy them into the project. Do the same for the constraints in the `constrs` folder and the simulations from the `sims` directory.
3. Inside `scripts/config.m`, change the `data_dir` variable to an existing directory where you want to store the data files for simulations. This path must be an absolute path, mot a relative path.
4. Also change the `fft_config_path` to the full ABSOLUTE path of the `fft_len.vhd` file inside the Vivado project you created, not the one inside the repo. A matlab script generates this config file and places it directly in the project to prevent from having to import it each time you change something in the config.


### Modelsim Simulator
The following is optional steps for seting up to use the modelsim simulator instead of the vivado one. I would use the vivado one if it DIDN'T KEEP CRASHING ON ME.

1. Since I use the modelsim simulator, I am required to compile the simulation libraries. Under tools, click `compile simulation libraries`.
2. In the `Simulator executable path`, paste in the directory your modelsim executable is held in and hit `compile`. The actual compiling may take a while to finish.
3. Under tools, click `options` and change the `ModelSim install path` under `3rd Part Tools` section to the directory containing the modelsim executable. This is the same one entered in the `Simulator executable path`. `Apply` and `Ok`.
4. In the simulation settings, select Modelsim simulator as the target simulator. A popup may appear warning you to compile the simulation libraries before running the simulation, which you have already done.
5. Change the `Simulation top module name` to `fft_tb_int_to_real`. This is the testbench used. `Apply` then `ok`.


## Simulation Usage
This is usage on how to run the simulation.

1. Generate the sample input data by running the matlab script `generate_data.m` under the `scripts` directory. This generates a signal consiting of 2 sinusoids of 2 different frequencies and magnitudes. The expected fft spectrum is shown also using MATLAB's builtin fft function.
2. In Vivado, hit `Run Simulation` to launch whatever simulator you are using. Make sure that all signals are initially defined. Runthe simulation for about `40 us`. Both the `end_of_data` and `end_of_sim` flags should be TRUE. The output fft data is now recorded in whatever the `output_data_path` is set in the matlab config.
3. Run the `plot_results.m` to plot the fft output generated by the fft implementation. For the sample input, the graph should show peaks at locations near the frequencies of the input sinusoids and look similar to the expected fft output graph initially generated by `generate_data.m`.


## Compiling/Bitstream Generation
For compiling the vhdl code onto the fpga, only the settings in `config.m` and the pin layout in the contraints file need to be changed to make sure there are enough pins on the fpga dev board to map to the icpx_width.
